<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Daily Workout</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/dayjs.min.js"></script>
  <script>
    // Make lodash and dayjs available globally
    window._ = _;
    window.dayjs = dayjs;
  </script>
</head>
<body class="bg-gray-900 p-2 md:p-8 flex flex-col" style="min-height: calc(100vh + 54px);">
<div class="flex-grow mx-auto bg-white rounded-xl shadow-md w-full max-w-md md:max-w-2xl flex flex-col p-4 space-y-6">
  <h1 class="font-semibold flex flex-col items-center">
    <span id="currentDay" class="text-lg"></span>
    <span id="currentDate" class="text-sm"></span>
  </h1>

  <ul id="workoutList" class="pl-5 space-y-2 flex-grow flex flex-col justify-around"></ul>
  <div class="flex space-x-2 items-center">
    <button id="prevDay" class="flex-grow bg-green-300 hover:bg-green-500 text-gray-700 font-bold py-2 px-4 rounded">
      ❮
    </button>
    <button id="todayButton"
            class="flex-grow bg-green-400 hover:bg-green-600 text-gray-700 font-bold py-2 px-4 rounded">
      Today
    </button>
    <button id="nextDay" class="flex-grow bg-green-300 hover:bg-green-500 text-gray-700 font-bold py-2 px-4 rounded">
      ❯
    </button>
  </div>
</div>
<div class="flex flex-col space-y-1 items-stretch mt-2">
  <p class="text-xs font-semibold text-white">Override</p>
  <div class="flex space-x-2">
    <button id="armsDay"
            class="flex-grow text-sm flex-grow bg-amber-200 hover:bg-amber-300 text-gray-700 font-bold py-1 px-2 rounded">
      Arms
    </button>
    <button id="legsDay"
            class="flex-grow text-sm flex-grow bg-amber-200 hover:bg-amber-300 text-gray-700 font-bold py-1 px-2 rounded">
      Legs
    </button>
  </div>
</div>

<script>
  // region Workout logic
  (function () {

    /**
     * All available exercises (simplified).
     * You can expand or reduce these lists as desired.
     * Each exercise has:
     *   - name: string
     *   - type: 'compound' | 'isolation'
     *   - primaryMuscles: string[]
     *   - unilateral: boolean (whether it trains one side at a time)
     */
    const LOWER_BODY_COMPOUND = [
      {
        name: 'RDL',
        type: 'compound',
        primaryMuscles: ['Hamstrings', 'Glutes'],
        unilateral: false
      },
      {
        name: 'Goblet Squat',
        type: 'compound',
        primaryMuscles: ['Quads', 'Glutes'],
        unilateral: false
      },
      {
        name: 'Bulgarian Split Squat',
        type: 'compound',
        primaryMuscles: ['Quads', 'Glutes'],
        unilateral: true
      },
      {
        name: 'Sumo Squat',
        type: 'compound',
        primaryMuscles: ['Quads', 'Glutes', 'Adductors'],
        unilateral: false
      },
      {
        name: 'Reverse Lunge',
        type: 'compound',
        primaryMuscles: ['Quads', 'Glutes', 'Hamstrings'],
        unilateral: true
      },
      {
        name: 'Step Up',
        type: 'compound',
        primaryMuscles: ['Quads', 'Glutes'],
        unilateral: true
      },
      {
        name: 'Single Leg RDL',
        type: 'compound',
        primaryMuscles: ['Hamstrings', 'Glutes'],
        unilateral: true
      }
    ];

    const LOWER_BODY_ISOLATION = [
      {
        name: 'BOSU Hamstring Curl',
        type: 'isolation',
        primaryMuscles: ['Hamstrings'],
        unilateral: false
      },
      {
        name: 'Banded Side Steps',
        type: 'isolation',
        primaryMuscles: ['Glute Medius / Abductors'],
        unilateral: true
      },
      {
        name: 'Clam Shell',
        type: 'isolation',
        primaryMuscles: ['Glute Medius / Abductors'],
        unilateral: false
      }
    ];

    const UPPER_BODY_COMPOUND = [
      {
        name: 'Chest Press',
        type: 'compound',
        primaryMuscles: ['Chest', 'Shoulders', 'Triceps'],
        unilateral: false
      },
      {
        name: 'Incline Chest Press',
        type: 'compound',
        primaryMuscles: ['Chest (Upper)', 'Shoulders', 'Triceps'],
        unilateral: false
      },
      {
        name: 'Shoulder Press',
        type: 'compound',
        primaryMuscles: ['Shoulders', 'Triceps'],
        unilateral: false
      },
      {
        name: 'Single Arm Bent Over Row',
        type: 'compound',
        primaryMuscles: ['Back', 'Biceps'],
        unilateral: true
      },
      {
        name: 'Quadruped Row',
        type: 'compound',
        primaryMuscles: ['Back', 'Biceps'],
        unilateral: true
      },
      {
        name: 'Chest Supported Row',
        type: 'compound',
        primaryMuscles: ['Back', 'Biceps'],
        unilateral: false
      },
      {
        name: 'Push-Ups',
        type: 'compound',
        primaryMuscles: ['Chest', 'Shoulders', 'Triceps', 'Core'],
        unilateral: false
      },
      {
        name: 'Bench Dips',
        type: 'compound',
        primaryMuscles: ['Triceps', 'Chest', 'Shoulders'],
        unilateral: false
      },
      {
        name: 'Renegade Row',
        type: 'compound',
        primaryMuscles: ['Back', 'Biceps', 'Core'],
        unilateral: true
      }
    ];

    const UPPER_BODY_ISOLATION = [
      {
        name: 'Bicep Curls',
        type: 'isolation',
        primaryMuscles: ['Biceps'],
        unilateral: false
      },
      {
        name: 'Hammer Curls',
        type: 'isolation',
        primaryMuscles: ['Biceps', 'Forearms'],
        unilateral: false
      },
      {
        name: 'Overhead Tricep Extension',
        type: 'isolation',
        primaryMuscles: ['Triceps'],
        unilateral: false
      },
      {
        name: 'Skull Crusher',
        type: 'isolation',
        primaryMuscles: ['Triceps'],
        unilateral: false
      },
      {
        name: 'Chest Fly',
        type: 'isolation',
        primaryMuscles: ['Chest'],
        unilateral: false
      },
      {
        name: 'Lat Pull Over',
        type: 'isolation',
        primaryMuscles: ['Lats'],
        unilateral: false
      },
      {
        name: 'Lateral Raises',
        type: 'isolation',
        primaryMuscles: ['Shoulders (Lateral Delts)'],
        unilateral: false
      }
    ];

    /**
     * Helper to produce a seeded RNG so each date returns the same random results.
     * This is a simplistic approach: we turn YYYYMMDD into a number, then use it
     */
    function createSeedFromDate(date) {
      // E.g. '2025-03-23' => 20250323
      const yyyy = date.getFullYear();
      const mm = String(date.getMonth() + 1).padStart(2, '0');
      const dd = String(date.getDate()).padStart(2, '0');
      return parseInt(`${yyyy}${mm}${dd}`);
    }

    /**
     * Main function to generate a workout for a given date.
     * Exports an array of exercise objects with sets/reps recommended.
     */
    function getWorkoutByDate(date, isLowerDay = null) {
      // 1) Determine if it's "Upper Body" day or "Lower Body" day.
      //    Simplistic approach: Even day of month => Lower, Odd day of month => Upper
      if (isLowerDay === null) {
        const dayOfMonth = date.getDate();
        isLowerDay = dayOfMonth % 2 === 0;
      }

      // 2) Convert date to a seed for consistent RNG.
      const seed = createSeedFromDate(date);

      // Lodash doesn't have a built-in "seed" param for shuffle in standard,
      // but you can set up your own PRNG or rely on an external library.
      // For simplicity, let's store a small pseudo-seed object
      // and increment it each time we call getRandomExercises
      const seedObj = {current: seed};

      // We'll define a simple function that updates the seed.
      // (Not a robust PRNG, just a consistent technique for example.)
      function nextSeed() {
        // A super-simple linear congruential generator (LCG)-style update:
        // (seed * 9301 + 49297) % 233280
        seedObj.current = (seedObj.current * 9301 + 49297) % 233280;
        return seedObj.current;
      }

      // We'll monkey-patch our own shuffle that uses nextSeed
      // to scramble array in a consistent way.
      function seededShuffle(arr, sObj) {
        // Make a copy
        const newArr = arr.slice();
        for (let i = newArr.length - 1; i > 0; i--) {
          // update the seed
          const randVal = nextSeed();
          // pick a random index
          const j = Math.floor(randVal % (i + 1));
          // swap
          [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
        }
        return newArr;
      }

      // Override getRandomExercises to use our seededShuffle
      function getRandomExercisesSeeded(array, count) {
        const shuffled = seededShuffle(array, seedObj);
        return shuffled.slice(0, count);
      }

      // 3) Build the workout
      let workout = [];

      if (isLowerDay) {
        // Lower Body Day

        // a) Pick 2-3 compound exercises.
        const lowerCompound = getRandomExercisesSeeded(LOWER_BODY_COMPOUND, 3);

        // b) Ensure at least one is unilateral. If not, swap one out.
        if (!lowerCompound.some(ex => ex.unilateral)) {
          // Insert a known unilateral from the list (e.g. Bulgarian Split Squat or Reverse Lunge)
          // We'll just forcibly pick 1 unilateral from the pool and then replace the last one in the array
          const unilateralPool = LOWER_BODY_COMPOUND.filter(ex => ex.unilateral);
          // Unilateral pick
          lowerCompound[lowerCompound.length - 1] = getRandomExercisesSeeded(unilateralPool, 1)[0];
        }

        // We'll limit ourselves to exactly 3 compounds for this example.
        const finalLowerCompound = lowerCompound.slice(0, 3);

        // c) Pick 1-2 isolation exercises
        const lowerIsolation = getRandomExercisesSeeded(LOWER_BODY_ISOLATION, 2);
        // Combine them
        workout = [...finalLowerCompound, ...lowerIsolation];
      } else {
        // Upper Body Day

        // a) Pick 2-3 compound exercises.
        const upperCompound = getRandomExercisesSeeded(UPPER_BODY_COMPOUND, 3);

        // b) Ensure at least one unilateral
        if (!upperCompound.some(ex => ex.unilateral)) {
          // Insert a unilateral from the pool
          const unilateralPool = UPPER_BODY_COMPOUND.filter(ex => ex.unilateral);
          // Unilateral pick
          upperCompound[upperCompound.length - 1] = getRandomExercisesSeeded(unilateralPool, 1)[0];
          ;
        }
        const finalUpperCompound = upperCompound.slice(0, 3);

        // c) Pick 1-2 isolation exercises
        const upperIsolation = getRandomExercisesSeeded(UPPER_BODY_ISOLATION, 2);

        // Combine them
        workout = [...finalUpperCompound, ...upperIsolation];
      }

      // 4) Attach recommended sets/reps and return workoutWithSetsReps
      //    - Compound: 3 x 8-12
      //    - Isolation: 3 x 12-15 (or 3 x 15-20 for some glute/leg isolation)

      return workout.map(ex => {
        let sets = 3;
        let repsRange = '8-12';

        // If it's isolation, we might go 12-15 or 15-20 for glutes
        if (ex.type === 'isolation') {
          // Quick hack: if it hits glutes or hamstrings we might do 15-20,
          // otherwise 12-15
          const primary = ex.primaryMuscles.map(m => m.toLowerCase()).join(' ');
          if (primary.includes('glute') || primary.includes('hamstring')) {
            repsRange = '15-20';
          } else {
            repsRange = '12-15';
          }
        }

        return {
          name: ex.name,
          type: ex.type,
          unilateral: ex.unilateral,
          primaryMuscles: ex.primaryMuscles,
          sets: sets,
          reps: repsRange
        };
      });
    }

    // Explicitly attach WorkoutGenerator to window
    window.WorkoutGenerator = {
      getWorkoutByDate: getWorkoutByDate
      // Add other methods here if needed
    };

    // Also attach getWorkoutByDate directly to window for easier testing
    window.getWorkoutByDate = getWorkoutByDate;
  })();
  // endregion


  // region Website logic
  const [SUN, MON, TUES, WED, THURS, FRI, SAT] = [0, 1, 2, 3, 4, 5, 6]

  let currentDate = dayjs();
  let dayOfWeek, isLowerDay, isUpperDay, isYogaDay, isDayOff

  const resetDay = () => {
    dayOfWeek = currentDate.day()
    isLowerDay = [TUES, FRI].includes(dayOfWeek)
    isUpperDay = [MON, THURS].includes(dayOfWeek)
    isYogaDay = dayOfWeek === WED
    isDayOff = [SAT, SUN].includes(dayOfWeek)
  }
  resetDay()

  const suggestedAlt = () => {
    if (isDayOff) return "Rest"
    if (isYogaDay) return "Yoga"
  }

  function updateWorkout({arms = false, legs = false} = {}) {
    let workout
    if (arms || isUpperDay) {
      workout = getWorkoutByDate(currentDate.toDate(), false);
    } else if (legs || isLowerDay) {
      workout = getWorkoutByDate(currentDate.toDate(), true);
    }
    const workoutList = document.getElementById('workoutList');
    workoutList.innerHTML = '';
    if (workout) {
      workout.forEach(exercise => {
        console.log('- ', JSON.stringify(exercise, null, 2));
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>${exercise.name}</strong> - ${exercise.sets} sets of ${exercise.reps} reps
          <br>
          <span class="text-sm text-gray-600">
            Type: ${exercise.type},
            ${exercise.unilateral ? 'Unilateral' : 'Bilateral'},
            Muscles: ${exercise.primaryMuscles.join(', ')}
          </span>
        `;
        workoutList.appendChild(li);
      });
    } else if (suggestedAlt()) {
      const li = document.createElement('li');
      li.className = 'flex-grow flex items-center justify-center'
      li.innerHTML = `<p class="text-md font-medium">${suggestedAlt()} Day</p>`;
      workoutList.appendChild(li);
    }

    document.getElementById('currentDay').textContent = currentDate.format('dddd');
    document.getElementById('currentDate').textContent = currentDate.format('MMM D');
  }

  document.getElementById('prevDay').addEventListener('click', () => {
    currentDate = currentDate.subtract(1, 'day');
    resetDay()
    updateWorkout();
  });

  document.getElementById('nextDay').addEventListener('click', () => {
    currentDate = currentDate.add(1, 'day');
    resetDay()
    updateWorkout();
  });

  document.getElementById('todayButton').addEventListener('click', () => {
    currentDate = dayjs();
    resetDay()
    updateWorkout();
  });

  document.getElementById('armsDay').addEventListener('click', () => {
    updateWorkout({arms: true});
  });

  document.getElementById('legsDay').addEventListener('click', () => {
    updateWorkout({legs: true});
  });


  updateWorkout();
  // endregion
</script>
</body>
</html>
