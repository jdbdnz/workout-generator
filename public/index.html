<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Daily Workout</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/dayjs.min.js"></script>
  <script>
    // Make lodash and dayjs available globally
    window._ = _;
    window.dayjs = dayjs;
  </script>
</head>
<body class="bg-gray-900 p-2 md:p-8 flex flex-col min-h-screen">
<div class="flex-grow mx-auto bg-white rounded-xl shadow-md w-full max-w-md flex flex-col p-4 space-y-6">
  <h1 class="font-semibold flex flex-col items-center">
    <span id="currentDay" class="text-lg"></span>
    <span id="currentDate" class="text-sm"></span>
  </h1>

  <ul id="workoutList" class="pl-5 space-y-2 flex-grow flex flex-col justify-around"></ul>
  <div class="flex space-x-2 items-center">
    <button id="prevDay" class="flex-grow bg-green-300 hover:bg-green-500 text-gray-700 font-bold py-2 px-4 rounded">
      ❮
    </button>
    <button id="todayButton"
            class="flex-grow bg-green-400 hover:bg-green-600 text-gray-700 font-bold py-2 px-4 rounded">
      Today
    </button>
    <button id="nextDay" class="flex-grow bg-green-300 hover:bg-green-500 text-gray-700 font-bold py-2 px-4 rounded">
      ❯
    </button>
  </div>
</div>
<div class="flex flex-col space-y-1 items-stretch mt-2 w-full max-w-md mx-auto">
  <p class="text-xs font-semibold text-white">Override</p>
  <div class="flex space-x-2">
    <button id="armsDay"
            class="flex-grow text-sm flex-grow bg-amber-200 hover:bg-amber-300 text-gray-700 font-bold py-1 px-2 rounded">
      Arms
    </button>
    <button id="legsDay"
            class="flex-grow text-sm flex-grow bg-amber-200 hover:bg-amber-300 text-gray-700 font-bold py-1 px-2 rounded">
      Legs
    </button>
  </div>
</div>

<script>
  (function workoutLogic() {

    // region exercises
    const EXERCISES = {
      "LOWER_BODY_COMPOUND": [
        {
          "name": "Goblet Squat",
          "primaryMuscles": [
            "Quads",
            "Glutes"
          ],
          "unilateral": false,
        },
        {
          "name": "Kettlebell Squat (can also be done with Dumbbell)",
          "primaryMuscles": [
            "Quads",
            "Glutes"
          ],
          "unilateral": false,
        },
        {
          "name": "Off Set Squat",
          "primaryMuscles": [
            "Quads",
            "Glutes"
          ],
          "unilateral": false,
        },
        {
          "name": "Sumo Squat",
          "primaryMuscles": [
            "Quads",
            "Glutes",
            "Abductors"
          ],
          "unilateral": false,
        },
        {
          "name": "Bulgarian Split Squat",
          "primaryMuscles": [
            "Quads",
            "Glutes"
          ],
          "unilateral": true,
        },
        {
          "name": "Front Foot Elevated Split Squat",
          "primaryMuscles": [
            "Quads",
            "Glutes"
          ],
          "unilateral": true,
        },
        {
          "name": "Reverse Lunge",
          "primaryMuscles": [
            "Quads",
            "Glutes"
          ],
          "unilateral": true,
        },
        {
          "name": "Step Up",
          "primaryMuscles": [
            "Quads",
            "Glutes"
          ],
          "unilateral": true,
        },
        {
          "name": "Side Lunge",
          "primaryMuscles": [
            "Quads",
            "Glutes",
            "Adductors"
          ],
          "unilateral": true,
        },
        {
          "name": "RDL",
          "primaryMuscles": [
            "Hamstrings",
            "Glutes"
          ],
          "unilateral": false,
          "D Weight": "-",
          "N Weight": "50lbs (25s in each hand)",
          "note": "@D: Usually we do this with the trap bar. Experiment with lighter weight and high reps to see if you back will tolerate these at home."
        },
        {
          "name": "Hip Thrust",
          "primaryMuscles": [
            "Glutes",
            "Hamstrings"
          ],
          "unilateral": false,
        },
        {
          "name": "B-Stance Rdl",
          "primaryMuscles": [
            "Hamstrings",
            "Glutes"
          ],
          "unilateral": true,
        },
        {
          "name": "Single Leg Rdl",
          "primaryMuscles": [
            "Hamstrings",
            "Glutes"
          ],
          "unilateral": true,
        },
        {
          "name": "Single Leg Hip Thrust",
          "primaryMuscles": [
            "Glutes",
            "Hamstrings"
          ],
          "unilateral": true,
        }
      ],
      "LOWER_BODY_ISOLATION": [
        {
          "name": "Bosu Hamstring Curl",
          "primaryMuscles": [
            "Hamstrings"
          ],
          "unilateral": false,
        },
        {
          "name": "Monster Walk",
          "primaryMuscles": [
            "Glutes"
          ],
          "unilateral": false,
        },
        {
          "name": "Banded Lateral Walk",
          "primaryMuscles": [
            "Abductors"
          ],
          "unilateral": false,
        },
        {
          "name": "Donkey Kicks",
          "primaryMuscles": [
            "Glutes"
          ],
          "unilateral": true,
          "D Weight": "Haven't tried but probably heavy",
          "N Weight": "Haven't tried but probably medium",
          "note": "demo: https://www.youtube.com/watch?v=qegd159vy10"
        },
        {
          "name": "Fire Hydrants",
          "primaryMuscles": [
            "Abductors"
          ],
          "unilateral": true,
        },
        {
          "name": "Clam Shell",
          "primaryMuscles": [
            "Abductors"
          ],
          "unilateral": true,
        }
      ],
      "UPPER_BODY_COMPOUND": [
        {
          "name": "Chest Press",
          "primaryMuscles": [
            "Chest",
            "Triceps",
            "Shoulders"
          ],
          "unilateral": false,
        },
        {
          "name": "Incline Chest Press",
          "primaryMuscles": [
            "Chest",
            "Shoulders",
            "Triceps"
          ],
          "unilateral": false,
        },
        {
          "name": "Push-Ups",
          "primaryMuscles": [
            "Chest",
            "Triceps",
            "Shoulders"
          ],
          "unilateral": false,
        },
        {
          "name": "Shoulder Press",
          "primaryMuscles": [
            "Shoulders",
            "Triceps"
          ],
          "unilateral": false,
        },
        {
          "name": "Standing Or Floor Seated Shoulder Press",
          "primaryMuscles": [
            "Shoulders",
            "Triceps (Core If Standing)"
          ],
          "unilateral": false,
        },
        {
          "name": "Bench Dips",
          "primaryMuscles": [
            "Triceps",
            "Chest",
            "Shoulders"
          ],
          "unilateral": false,
        },
        {
          "name": "Single Arm Bent Over Row",
          "primaryMuscles": [
            "Back",
            "Lats",
            "Biceps"
          ],
          "unilateral": true,
        },
        {
          "name": "Quadruped Row",
          "primaryMuscles": [
            "Back",
            "Lats",
            "Biceps",
            "Core"
          ],
          "unilateral": true,
        },
        {
          "name": "Chest Supported Row",
          "primaryMuscles": [
            "Back",
            "Lats",
            "Biceps"
          ],
          "unilateral": false,
        },
        {
          "name": "Renegade Row (Also Good For Core)",
          "primaryMuscles": [
            "Back",
            "Lats",
            "Biceps",
            "Core"
          ],
          "unilateral": true,
        }
      ],
      "UPPER_BODY_ISOLATION": [
        {
          "name": "Chest Fly",
          "primaryMuscles": [
            "Chest"
          ],
          "unilateral": false,
        },
        {
          "name": "Lateral Raises",
          "primaryMuscles": [
            "Shoulders"
          ],
          "unilateral": false,
        },
        {
          "name": "Overhead Tricep Extension",
          "primaryMuscles": [
            "Triceps"
          ],
          "unilateral": false,
        },
        {
          "name": "Skull Crusher",
          "primaryMuscles": [
            "Triceps"
          ],
          "unilateral": false,
          "D Weight": "20lbs in each hand",
          "N Weight": "10lbs in each hand",
          "note": NaN
        },
        {
          "name": "Seated Reverse Fly",
          "primaryMuscles": [
            "Shoulders"
          ],
          "unilateral": false,
        },
        {
          "name": "Lat Pull Over",
          "primaryMuscles": [
            "Lats"
          ],
          "unilateral": false,
        },
        {
          "name": "Y's, T's, W's",
          "primaryMuscles": [
            "Shoulders",
            "Back",
            "Rotator Cuff"
          ],
          "unilateral": false,
          "D Weight": "Can hold little Dbs",
          "N Weight": "Can hold little Dbs",
          "note": "Good to do at the beginning of a back day for mobility or at the end of a workout as a burnout/accesory movement"
        },
        {
          "name": "Bicep Curls",
          "primaryMuscles": [
            "Biceps"
          ],
          "unilateral": true,
        },
        {
          "name": "Hammer Curls",
          "primaryMuscles": [
            "Biceps"
          ],
          "unilateral": true,
        },
        {
          "name": "Static Bicep Curl",
          "primaryMuscles": [
            "Biceps"
          ],
          "unilateral": true,
        }
      ],
      "CORE_EXERCISES": [
        {
          "name": "Deadbugs (Can Also Be Weighted)",
          "primaryMuscles": [
            "Lower Abs",
            "Deep Core"
          ],
          "unilateral": false,
        },
        {
          "name": "Plank",
          "primaryMuscles": [
            "Deep Core"
          ],
          "unilateral": false,
          "D Weight": "Maybe 30 sec at a time",
          "N Weight": "Longest time: 1 min.",
          "note": "Deep Core \u2192 Involves all major core muscles (upper abs, lower abs, obliques, transverse abdominis, and sometimes spinal stabilizers) working together."
        },
        {
          "name": "Bear Hold",
          "primaryMuscles": [
            "Deep Core"
          ],
          "unilateral": false,
        },
        {
          "name": "Bear Hold Pull Through",
          "primaryMuscles": [
            "Core (Abs",
            "Obliques)",
            "Shoulders"
          ],
          "unilateral": true,
        },
        {
          "name": "DB Rotations",
          "primaryMuscles": [
            "Obliques",
            "Deep Core (Rotational Strength)"
          ],
          "unilateral": false,
        },
        {
          "name": "Weighted Sl Lowers",
          "primaryMuscles": [
            "Lower Abs"
          ],
          "unilateral": false,
        },
        {
          "name": "Alternating V-Up",
          "primaryMuscles": [
            "Abs"
          ],
          "unilateral": true,
          "D Weight": "yes",
          "N Weight": "Bodyweight",
          "note": NaN
        },
        {
          "name": "V-Up",
          "primaryMuscles": [
            "Abs"
          ],
          "unilateral": false,
        },
        {
          "name": "Russian Twist",
          "primaryMuscles": [
            "Obliques",
            "Deep Core (Rotational Strength)"
          ],
          "unilateral": false,
        },
        {
          "name": "Overhead Weighted Sit Up",
          "primaryMuscles": [
            "Upper Abs"
          ],
          "unilateral": false,
        },
        {
          "name": "Toe Reaches",
          "primaryMuscles": [
            "Upper Abs"
          ],
          "unilateral": false,
          "D Weight": "no",
          "N Weight": "10lbs",
          "note": NaN
        },
        {
          "name": "Side Plank Twist",
          "primaryMuscles": [
            "Obliques",
            "Deep Core (Rotational Strength)"
          ],
          "unilateral": false,
        },
        {
          "name": "Copenhagen Plank",
          "primaryMuscles": [
            "Obliques",
            "Adductors",
            "Deep Core"
          ],
          "unilateral": false,
        }
      ]
    };

    // endregion

    /**
     * Helper to produce a seeded RNG so each date returns the same random results.
     * This is a simplistic approach: we turn YYYYMMDD into a number, then use it
     */
    function createSeedFromDate(date) {
      // E.g. '2025-03-23' => 20250323
      const yyyy = date.getFullYear();
      const mm = String(date.getMonth() + 1).padStart(2, '0');
      const dd = String(date.getDate()).padStart(2, '0');
      return parseInt(`${yyyy}${mm}${dd}`);
    }

    const dateShuffle = date => array => {
      const seed = createSeedFromDate(date);
      const copy = [...array];
      let state = seed;

      // Simple pseudo-random number generator
      const random = () => {
        state = (state * 1664525 + 1013904223) % 4294967296;
        return state / 4294967296;
      };

      let m = array.length, t, i;
      // While there remain elements to shuffle…
      while (m) {
        // Pick a remaining element…
        i = Math.floor(random() * m--);

        // And swap it with the current element.
        t = copy[m];
        copy[m] = copy[i];
        copy[i] = t;
      }

      return copy;
    }

    function getRandomExercises(date, compoundList, isolationList) {
      const randomizeExercises = dateShuffle(date)

      // Pick 2 compound exercises, ensure at least one is unilateral
      const compoundRand = randomizeExercises(compoundList);
      const idx = compoundRand.findIndex(a => a.unilateral);
      const compound = [compoundRand[idx], compoundRand[idx + 1]].map(a => ({
        type: 'Compound',
        ...a,
      }))

      // Pick 2 isolation exercises
      const isolation = randomizeExercises(isolationList).slice(0, 2).map(a => ({
        type: 'Isolation',
        ...a,
      }))

      // Combine
      return [...compound, ...isolation];
    }

    function getRandomCore(date) {
      const randomizeExercises = dateShuffle(date)
      return randomizeExercises(EXERCISES.CORE_EXERCISES)[0]
    }


    /**
     * Main function to generate a workout for a given date.
     * Exports an array of exercise objects with sets/reps recommended.
     */
    function getWorkoutByDate(date, isLowerDay = false) {

      const workout = isLowerDay
        ? getRandomExercises(date, EXERCISES.LOWER_BODY_COMPOUND, EXERCISES.LOWER_BODY_ISOLATION)
        : getRandomExercises(date, EXERCISES.UPPER_BODY_COMPOUND, EXERCISES.UPPER_BODY_ISOLATION)

      const core = getRandomCore(date)
      core.type = "Core"
      workout.push(core)

      // Describe features
      workout.forEach(workout => {
        const descriptors = [workout.type]
        if (workout.type !== "Core") {
          descriptors.push(workout.unilateral ? 'Unilateral' : 'Bilateral')
        }
        descriptors.push(workout.primaryMuscles.join(', '))
        workout.description = descriptors.join(', ')
      })

      return workout.map(ex => {
        let sets = 3;
        let repsRange = '8-12';

        // If it's isolation, we might go 12-15 or 15-20 for glutes or hamstrings
        if (ex.type === 'isolation') {
          const primary = ex.primaryMuscles.map(m => m.toLowerCase()).join(' ');
          if (primary.includes('glute') || primary.includes('hamstring')) {
            repsRange = '15-20';
          } else {
            repsRange = '12-15';
          }
        }

        const descriptors = [ex.type]
        if (ex.type !== "Core") {
          descriptors.push(ex.unilateral ? 'Unilateral' : 'Bilateral')
        }
        descriptors.push(ex.primaryMuscles.join(', '))

        let weight
        if (ex["D Weight"] || ex["N Weight"]) {
          weight = {
            d: ex["D Weight"],
            n: ex["N Weight"],
          }
        }

        return {
          name: ex.name,
          type: ex.type,
          sets: sets,
          reps: repsRange,
          note: ex.note,
          description: descriptors.join(', '),
          weight,
        };
      });
    }

    // Explicitly attach WorkoutGenerator to window
    window.WorkoutGenerator = {
      getWorkoutByDate: getWorkoutByDate
      // Add other methods here if needed
    };

    // Also attach getWorkoutByDate directly to window for easier testing
    window.getWorkoutByDate = getWorkoutByDate;
  })();


  // region Website logic
  (function websiteLogic() {
    const [SUN, MON, TUES, WED, THURS, FRI, SAT] = [0, 1, 2, 3, 4, 5, 6]

    let currentDate = dayjs();
    let dayOfWeek, isLowerDay, isUpperDay, isYogaDay, isDayOff

    const resetDay = () => {
      dayOfWeek = currentDate.day()
      isLowerDay = [TUES, FRI].includes(dayOfWeek)
      isUpperDay = [MON, THURS].includes(dayOfWeek)
      isYogaDay = dayOfWeek === WED
      isDayOff = [SAT, SUN].includes(dayOfWeek)
    }
    resetDay()

    const suggestedAlt = () => {
      if (isDayOff) return "Rest"
      if (isYogaDay) return "Yoga"
    }

    function updateWorkout() {
      let workout
      if (isUpperDay) {
        workout = getWorkoutByDate(currentDate.toDate(), false);
      } else if (isLowerDay) {
        workout = getWorkoutByDate(currentDate.toDate(), true);
      }
      console.log(JSON.stringify(workout, null, 2))
      const workoutList = document.getElementById('workoutList');
      workoutList.innerHTML = '';
      if (workout) {
        workout.forEach(exercise => {
          const li = document.createElement('li');
          li.innerHTML = `
            <strong>${exercise.name}</strong> · ${exercise.sets} sets, ${exercise.reps}
            <br>
            <span class="text-sm text-gray-600">
              ${exercise.description}
            </span>
          `;

          if (exercise.weight) {
            li.innerHTML += `
              <br>
              <span class="text-sm text-gray-600">
              D ${exercise.weight.d},
              </span>
              <span class="text-sm text-gray-600">
              N ${exercise.weight.n}
              </span>
            `;
          }

          if (exercise.note?.length) {
            li.innerHTML += `
              <br>
              <span class="text-sm italic text-gray-600">
                "${exercise.note}"
              </span>
            `;
          }

          workoutList.appendChild(li);
        });
      } else if (suggestedAlt()) {
        const li = document.createElement('li');
        li.className = 'flex-grow flex items-center justify-center'
        li.innerHTML = `<p class="text-md font-medium">${suggestedAlt()} Day</p>`;
        workoutList.appendChild(li);
      }

      document.getElementById('currentDay').textContent = currentDate.format('dddd');
      document.getElementById('currentDate').textContent = currentDate.format('MMM D');
    }

    document.getElementById('prevDay').addEventListener('click', () => {
      currentDate = currentDate.subtract(1, 'day');
      resetDay()
      updateWorkout();
    });

    document.getElementById('nextDay').addEventListener('click', () => {
      currentDate = currentDate.add(1, 'day');
      resetDay()
      updateWorkout();
    });

    document.getElementById('todayButton').addEventListener('click', () => {
      currentDate = dayjs();
      resetDay()
      updateWorkout();
    });

    document.getElementById('armsDay').addEventListener('click', () => {
      dayOfWeek = false
      isLowerDay = false
      isUpperDay = true
      isYogaDay = false
      isDayOff = false
      updateWorkout();
    });

    document.getElementById('legsDay').addEventListener('click', () => {
      dayOfWeek = false
      isLowerDay = true
      isUpperDay = false
      isYogaDay = false
      isDayOff = false
      updateWorkout();
    });


    updateWorkout();
  })();
</script>
</body>
</html>
